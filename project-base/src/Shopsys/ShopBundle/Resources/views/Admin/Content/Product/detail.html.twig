{% extends '@ShopsysShop/Admin/Layout/layoutWithPanel.html.twig' %}
{% set showHeading = false %}
{% import '@ShopsysShop/Admin/Form/seoFormRowMacros.html.twig' as seoFormRowMacros %}

{% block title %}- {{ 'Product detail'|trans }}{% endblock %}
{% block h1 %}{% endblock %}

{% block header %}
    <header class="web__header">
        <div class="web__header__in web__header__in--small">
            <div class="top-info">
                <div class="top-info__logo">
                    <span class="sprite sprite-logo"></span>
                </div>
                <div class="top-info__text">
                    <h1 class="top-info__text__title">{% block product_header_heading %}{% endblock %}</h1>
                </div>
            </div>
        </div>
    </header>
{% endblock %}

{% block menu_panel %}
    <div class="panel">
        <ul class="anchor-menu js-product-detail-navigation"></ul>
    </div>
    {% block menu_panel_visibilities %}{% endblock %}
{% endblock %}

{% block breadcrumb %}{% endblock %}

{% block main_content %}
    {% if isMultidomain() %}
        {% set cssClassOnMultidomainInputs = 'input--domain' %}
    {% else %}
        {% set cssClassOnMultidomainInputs = '' %}
    {% endif %}

    {{ form_start(form) }}
        <div id="product_edit_form_productData"></div>
        {{ form_errors(form) }}

        <div class="wrap-border wrap-border--small">
            <dl class="form-full">
                <dt class="form-full__title">
                    {{ 'Name'|trans }}
                </dt>
                {% for locale, formName in form.productData.name %}
                    <dd class="form-full__field">
                        <span class="form-full__field__flag">
                            {{ localeFlag(locale) }}
                        </span>
                        {{ form_widget(formName) }}
                        {{ form_errors(formName) }}
                    </dd>
                {% endfor %}
            </dl>
        </div>

        {% block product_variants %}{% endblock %}

        <div class="form-group wrap-border">

            <div class="form-group__title">
                {{ 'Basic information'|trans }}
            </div>

            {% block product_catnum %}
                {{ form_row(form.productData.catnum, { label: 'Catalogue number'|trans }) }}
            {% endblock %}

            {% block product_partno %}
                {{ form_row(form.productData.partno, { label: 'PartNo (serial number)'|trans }) }}
            {% endblock %}

            {% block product_ean %}
                {{ form_row(form.productData.ean, { label: 'EAN'|trans }) }}
            {% endblock %}

            {{ form_id(product|default(null)) }}

            {{ form_row(form.productData.flags, { label: 'Flags'|trans}) }}

            {{ form_row(form.productData.brand, { label: 'Brand'|trans}) }}

        </div>

        <div class="form-group wrap-border">

            <div class="form-group__title">
                {{ 'Display and availability'|trans }}
            </div>

            {{ form_row(form.productData.hidden, { label: 'Hide product'|trans }) }}

            {% block product_calculated_hidden_info %}{% endblock %}

            {{ form_row(form.productData.sellingFrom, { label: 'Selling start date'|trans }) }}

            {{ form_row(form.productData.sellingTo, { label: 'Selling end date'|trans }) }}

            {{ form_row(form.productData.sellingDenied, { label: 'Exclude from sale'|trans,
                icon: {
                    title: 'Products excluded from sale can\'t be displayed on lists and can\'t be searched. Product detail is available by direct access from the URL, but it is not possible to add product to cart.'|trans
                } }) }}

            {% block product_calculated_selling_denied_info %}{% endblock %}

            {% block product_main_categories %}{% endblock %}

            {% block product_categories %}
                {{ form_row(form.productData.categoriesByDomainId, { label: 'Assign to category'|trans }) }}
            {% endblock %}

            {{ form_row(form.productData.unit, { label: 'Unit'|trans }) }}

            {% block product_stock_and_availability %}
                {{ form_row(form.productData.usingStock, { label: 'Use stocks'|trans }) }}
                <div class="js-product-using-stock">
                    {{ form_row(form.productData.stockQuantity, { label: 'Available in stock'|trans }) }}
                    {{ form_row(form.productData.outOfStockAction, { label: 'Action after sellout'|trans }) }}
                    <div class="js-product-using-stock-and-alternate-availability">
                        {{ form_row(form.productData.outOfStockAvailability, { label: 'Availability after sellout'|trans }) }}
                    </div>
                </div>
                <div class="js-product-not-using-stock">
                    {{ form_row(form.productData.availability, { label: 'Availability'|trans }) }}
                </div>
            {% endblock %}

            {{ form_row(form.productData.orderingPriority, { label: 'Sorting priority'|trans }) }}

        </div>

        <div class="form-group wrap-border">

            <div class="form-group__title">
                {{ 'Prices'|trans }}
            </div>

            {% block product_pricing %}
                {{ form_row(form.productData.priceCalculationType, { label: 'Sale prices calculation'|trans }) }}
                {{ form_row(form.productData.vat, { label: 'VAT'|trans }) }}

                {% block product_calculated_prices %}{% endblock %}
            {% endblock %}

        </div>

        <div class="form-group wrap-border">
            <div class="form-group__title">
                {{ 'Description'|trans }}
            </div>

            {% block product_description %}
                {{ form_row(form.descriptions, { label: false }) }}
            {% endblock %}
        </div>

        <div class="form-group wrap-border">
            <div class="form-group__title">
                {{ 'Short description'|trans }}
            </div>

            {% block product_short_description %}
                {{ form_row(form.shortDescriptions, { label: false } ) }}
            {% endblock %}
        </div>

        <div class="js-form-group wrap-border form-group">
            <div class="form-group__title">
                <span class="js-validation-label">{{ 'Parameters'|trans }}</span>

                {{ form_errors(form.parameters) }}
            </div>

            <dl class="form-line form-line--visible">
                <dt>
                    {{ 'Parameter'|trans }}
                </dt>
                <dd>
                    <strong>
                        {{ 'Value'|trans }}
                    </strong>
                </dd>
            </dl>
            <div class="js-parameters" data-prototype="{{ _self.parameterRow(form.parameters.vars.prototype)|escape }}" data-index="{{ form.parameters|length }}">
                {% macro parameterRow(parameter, index) %}
                    <div class="js-parameters-item js-form-group" data-index="{{ index }}">
                        {% for locale, valueTextLocaleForm in parameter.valueTextsByLocale %}
                            <dl class="form-line">
                                <dt>
                                    {% if loop.first %}
                                        {{ form_widget(parameter.parameter) }}
                                    {% endif %}
                                </dt>
                                <dd>
                                    <span class="svg svg-arrow-right"></span>
                                    {{ localeFlag(locale) }}
                                    {{ form_widget(valueTextLocaleForm) }}
                                    {{ form_errors(valueTextLocaleForm) }}
                                    {% if loop.first %}
                                        <a href="#" class="js-parameters-item-remove table-form__action"><i class="svg svg-circle-cross"></i></a>
                                    {% endif %}
                                </dd>
                            </dl>
                        {% endfor %}
                    </div>
                {% endmacro %}

                {% for key, parameter in form.parameters %}
                    {{ _self.parameterRow(parameter, key) }}
                {% else %}
                    {% do form.parameters.setRendered %}
                {% endfor %}

                <dl class="js-parameters-empty-item form-line">
                    <dt></dt>
                    <dd>{{ 'Add some parameters'|trans }}</dd>
                </dl>
            </div>

            <dl class="form-line">
                <dd>
                    <a href="#" class="js-parameters-item-add btn btn--plus">
                        <i class="btn__icon">+</i>
                        {{ 'Add another parameter'|trans }}
                    </a>
                </dd>
            </dl>
        </div>

        <div class="form-group wrap-border">
            <div class="form-group__title">
                {{ 'SEO'|trans }}
            </div>

            {{ seoFormRowMacros.multidomainRow(form.seoTitles, 'Page title'|trans, 60) }}

            {{ seoFormRowMacros.multidomainRow(form.seoMetaDescriptions, 'Meta description'|trans, 155, 'input--seo') }}

            {{ form_row(form.seoH1s, { label: 'Heading (H1)'|trans } ) }}

            {% block product_urls %}{% endblock %}
        </div>

        <div class="form-group wrap-border">
            <div class="form-group__title">
                {{ 'Images'|trans }}
            </div>

            {% block images %}{% endblock %}
            {{ form_row(form.imagesToUpload, { label: false, infoText: 'You can upload following formats: PNG, JPG, GIF'|trans }) }}
            {{ form_errors(form.imagesToUpload) }}
            {{ form_widget(form.imagesToDelete, { attr: { style: 'display: none;' } }) }}
        </div>

        <div class="form-group {% if form.pluginData is not empty %}wrap-border{% endif %}">
            <div class="form-group__title">
                {{ 'Accessories'|trans }}
                <div class="form-group__error">
                    {{- form_errors(form.accessories) -}}
                </div>
            </div>
            {{- form_widget(form.accessories) -}}
        </div>

        {% if form.pluginData is empty %}
            {% do form.pluginData.setRendered %}
        {% else %}
            {% for pluginForm in form.pluginData %}
                <div class="form-group {% if not loop.last %}wrap-border{% endif %}">
                    <div class="form-group__title">
                        {{ pluginForm.vars.label }}
                    </div>

                    {{ form_widget(pluginForm) }}
                    {{ form_errors(pluginForm) }}
                </div>
            {% endfor %}
        {% endif %}

        {% embed '@ShopsysShop/Admin/Inline/FixedBar/fixedBar.html.twig' %}
            {% block fixed_bar_content %}
                <button id="js-close-without-saving" type="button" class="btn-link-style">{{ 'Close without saving'|trans }}</button>
                {{ form_save(product|default(null), form) }}
            {% endblock %}
        {% endembed %}

    {{ form_end(form) }}

{% endblock %}
