{% extends '@ShopsysShop/Admin/Content/Product/detail.html.twig' %}

{% block title -%}
    - {{ 'Editing product'|trans }} - {{ product|productDisplayName }}
{% endblock %}

{% block product_header_heading %}
    <span>{{ 'Editing product'|trans }}: </span>{{ product.name }}
{% endblock %}

{% block menu_panel_visibilities %}
    <div class="panel">
        <div class="panel__in">
            <div class="panel__in__title">
                {{ 'Visibility'|trans }}
            </div>
            {% if productDetail.product.calculatedSellingDenied %}
                <div class="in-message in-message--warning in-message--small in-message--block">
                    {{ 'Product excluded from sale.'|trans }}
                </div>
            {% endif %}
            {% include '@ShopsysShop/Admin/Content/Product/visibilityItems.html.twig' with {productDetail: productDetail} only %}
        </div>
    </div>
{% endblock %}

{% block product_variants %}
    {% if product.isVariant %}
        <div class="wrap-border form-group">
            <div class="form-group__title">
                {{ 'Variant'|trans }}
            </div>
            <dl class="form-line">
                <dt>
                    {{ 'Product is variant'|trans }}:
                </dt>
                <dd>
                    <a href="{{ url('admin_product_edit', {id: product.mainVariant.id}) }}" target="_blank">
                        <i class="svg svg-forward-page in-icon in-icon--link ml5 mr5"></i>{{ product.mainVariant.name }}
                    </a>
                </dd>
            </dl>
            {{ form_row(form.productData.variantAlias, { label: 'Variant alias'|trans }) }}
        </div>
    {% endif %}
    {% if product.isMainVariant %}
        <div class="wrap-border form-group">
            <div class="in-message in-message--info in-message--block margin-bottom-25">
                {{ 'Product is main variant.'|trans }}
            </div>
            {{ form_row(form.variants, { label: 'Variants'|trans, labelButtonAdd: 'Add variant'|trans }) }}
        </div>
    {% endif %}
{% endblock %}

{% block product_catnum %}
    {% if product.isMainVariant %}
        {{ form_row(form.productData.catnum, { label: 'Catalogue number'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_partno %}
    {% if product.isMainVariant %}
        {{ form_row(form.productData.partno, { label: 'PartNo (serial number)'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_ean %}
    {% if product.isMainVariant %}
        {{ form_row(form.productData.ean, { label: 'EAN'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_stock_and_availability %}
    {% if product.isMainVariant %}
        {{ form_row(form.productData.usingStock, { label: 'Use stocks'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
        <div class="js-product-using-stock">
            {{ form_row(form.productData.stockQuantity, { label: 'Available in stock'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
            {{ form_row(form.productData.outOfStockAction, { label: 'Action after sellout'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
            <div class="js-product-using-stock-and-alternate-availability">
                {{ form_row(form.productData.outOfStockAvailability, { label: 'Availability after sellout'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
            </div>
        </div>
        <div class="js-product-not-using-stock">
            {{ form_row(form.productData.availability, { label: 'Availability'|trans, disabledField: { title: 'This item can be set in product detail of a specific variant'|trans, class: 'form-line__disabled' } }) }}
        </div>
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_calculated_hidden_info %}
    {% if product.isUsingStock and product.calculatedHidden and product.stockQuantity <= 0 %}
        <dl class="form-line">
            <dd>
                <div class="in-message in-message--warning">
                    <span class="in-message__icon svg svg-warning"></span>
                    {{ 'Product is hidden due to sellout'|trans }}
                </div>
            </dd>
        </dl>
    {% endif %}
{% endblock %}

{% block product_calculated_selling_denied_info %}
    {% if product.isUsingStock and product.calculatedSellingDenied and product.stockQuantity <= 0 %}
        <dl class="form-line">
            <dd>
                <div class="in-message in-message--warning">
                    <span class="in-message__icon svg svg-warning"></span>
                    {{ 'Product is excluded from the sale due to sellout'|trans }}
                </div>
            </dd>
        </dl>
    {% endif %}
{% endblock %}

{% block product_main_categories %}
    {% for domainId, mainCategory in productMainCategoriesIndexedByDomainId %}
        <dl class="form-line {% if not loop.first %}form-line--no-delimiter{% endif %}">
            <dt>
                {% if mainCategory is null %}
                    {% set mainCategoryName = '-' %}
                {% else %}
                    {% set mainCategoryName = mainCategory.name %}
                {% endif %}

                {% if loop.first %}
                    <label>
                        {% if productMainCategoriesIndexedByDomainId|length > 1 %}
                            {{ 'Main category on domains:' |trans }}
                        {% else %}
                            {{ 'Main category:' |trans }}
                        {% endif %}
                    </label>
                {% endif %}
            </dt>
            <dd>
                {% if isMultidomain() %}
                    {{ domainIcon(domainId) }}
                {% endif %}
                <input
                    type="text"
                    value="{{ mainCategoryName }}"
                    class="input{% if isMultidomain() %} input--domain{% endif %}"
                    readonly="readonly"
                >
            </dd>
        </dl>
    {% endfor %}

{% endblock %}

{% block product_categories %}
    {% if product.isVariant %}
        {% do form.productData.categoriesByDomainId.setRendered %}
        <dl class="form-line">
            <dt>
                {{ form_label(form.productData.categoriesByDomainId, 'Assign to category'|trans) }}
            </dt>
            <dd>
                {{ 'You can set the categories on product detail of the main variant'|trans }}
            </dd>
        </dl>
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_pricing %}
    {% if product.isMainVariant %}
        <dl class="form-line form-line--disabled">
            <dd>
                <strong>{{ 'You can set the prices on product detail of specific variant.'|trans }}</strong>
            </dd>
        </dl>
        {% do form.productData.priceCalculationType.setRendered %}
        {% do form.productData.vat.setRendered %}
        {% do form.productData.price.setRendered %}
        {% do form.manualInputPricesByPricingGroupId.setRendered %}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_calculated_prices %}
    <div class="box-product-prices">
        <dl class="form-line form-line--visible">
            <dt></dt>
            <dd>
                <div class="box-product-prices__input">
                    <strong>
                        {{ inputPriceLabel() }}
                    </strong>
                </div>
                <div class="box-product-prices__error"></div>
                <div class="box-product-prices__price">
                    <strong>
                        {{ 'Price excluding VAT'|trans }}
                    </strong>
                </div>
                <div class="box-product-prices__price">
                    <strong>
                        {{ 'Price including VAT'|trans }}
                    </strong>
                </div>
            </dd>
        </dl>
        <dl class="form-line js-input-price-type-auto">
            <dt>
                {{ form_label(form.productData.price, 'Base price'|trans, { isSimple: true, compulsoryClass: 'form-line__compulsory' } ) }}
            </dt>
            <dd>
                <div class="box-product-prices__input form-line__inner-flex">
                    {{ form_widget(form.productData.price, { symbolAfterInput: currencySymbolDefault() }) }}
                </div>
                <div class="box-product-prices__error">
                    {{ form_errors(form.productData.price) }}
                </div>
                {% if productBasePrice is defined %}
                    <div class="box-product-prices__price">
                        {{ productBasePrice.priceWithoutVat|priceWithCurrencyAdmin }}
                    </div>
                    <div class="box-product-prices__price">
                        <strong>{{ productBasePrice.priceWithVat|priceWithCurrencyAdmin }}</strong>
                    </div>
                {% else %}
                    <div class="box-product-prices__price">-</div>
                    <div class="box-product-prices__price"><strong>-</strong></div>
                {% endif %}
            </dd>
        </dl>
        {% for domainId, productSellingPrices in productSellingPricesIndexedByDomainId %}
            {% if isMultidomain() %}
                <dl class="form-line form-line--group-label">
                    <dt>
                        {{ domainIcon(domainId) }}
                        {{ getDomainName(domainId) }}
                    </dt>
                </dl>
            {% endif %}
            {% for productSellingPrice in productSellingPrices %}
                <dl class="form-line">
                    <dt>
                        {{ form_label(form.manualInputPricesByPricingGroupId[productSellingPrice.pricingGroup.id], productSellingPrice.pricingGroup.name, { isSimple: true, compulsoryClass: 'form-line__compulsory js-input-price-type-manual' }) }}
                    </dt>
                    <dd>
                        <div class="js-input-price-type-manual form-line__inner-flex box-product-prices__input">
                            {{ form_widget(form.manualInputPricesByPricingGroupId[productSellingPrice.pricingGroup.id], { symbolAfterInput: currencySymbolByDomainId(domainId) }) }}
                        </div>
                        <div class="js-input-price-type-manual box-product-prices__error">
                            {{ form_errors(form.manualInputPricesByPricingGroupId[productSellingPrice.pricingGroup.id] ) }}
                        </div>
                        <div class="js-input-price-type-auto box-product-prices__error">
                        </div>
                        <div class="js-input-price-type-auto box-product-prices__input">&nbsp;</div>
                        <div class="box-product-prices__price">
                            {{ productSellingPrice.sellingPrice.priceWithoutVat|priceWithCurrencyByDomainId(domainId) }}
                        </div>
                        <div class="box-product-prices__price">
                            <strong>{{ productSellingPrice.sellingPrice.priceWithVat|priceWithCurrencyByDomainId(domainId) }}</strong>
                        </div>
                    </dd>
                </dl>
            {% endfor %}
        {% endfor %}
    </div>
{% endblock %}

{% block product_description %}
    {% if product.isVariant %}
        <dl class="form-line form-line--disabled">
            <dd>
                <strong>{{ 'Description can be set on product detail of the main product.'|trans }}</strong>
            </dd>
        </dl>
        {% do form.descriptions.setRendered %}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block product_short_description %}
    {% if product.isVariant %}
        <dl class="form-line form-line--disabled">
            <dd>
                <strong>{{ 'Short description can be set in the main variant.'|trans }}</strong>
            </dd>
        </dl>
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block images %}
    {% if form.orderedImagesById|length > 0 %}
        <dl class="form-line">
            <dd>
                <div class="list-images">
                    <ul class="list-images__list" id="js-product-images">
                        {% for imageForm in form.orderedImagesById %}
                            {% set image = productDetail.imagesIndexedById[imageForm.vars.value] %}
                            <li class="list-images__item js-product-images-image" data-id="{{ image.id }}">
                                <div class="list-images__item__in">
                                    <div class="list-images__item__image js-product-images-preview">
                                        {{ image(image, {size: 'original', height: '100'}) }}
                                    </div>
                                    <span class="list-images__item__main">
                                        {{ 'Main image'|trans }}
                                    </span>
                                    <button class="js-product-images-delete-button btn-no-style list-images__item__remove" type="button" title="{{ 'Delete'|trans }}">
                                        <i class="svg svg-circle-cross"></i>
                                    </button>
                                    <span class="js-product-images-image-handle list-images__item__move" title="{{ 'Move'|trans }}">
                                        <i class="svg svg-move"></i>
                                    </span>
                                    <button class="btn-no-style js-product-images-delete-revert-button display-none list-images__item__revert" type="button" title="{{ 'Return back'|trans }}">
                                        <i class="svg svg-forward-page"></i>
                                    </button>
                                    <span class="list-images__item__overlay js-product-images-image-overlay">{{ 'Image will be deleted after saving.'|trans }}</span>
                                </div>
                                {# Ignore indices from form definition. Let them reflect new positions. #}
                                {{ form_widget(imageForm, { full_name: form.orderedImagesById.vars.full_name ~ '[]'}) }}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </dd>
        </dl>
    {% endif %}
    {% do form.orderedImagesById.setRendered %}
{% endblock %}

{% block product_urls %}
    {{ form_row(form.urls, { label: 'URL settings'|trans }) }}
{% endblock %}
